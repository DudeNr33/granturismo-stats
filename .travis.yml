language: python
cache: pip
python:
- 3.6
- 3.7
- 3.8
- 3.9
matrix:
  include:
  - stage: static analysis
    python: 3.9
    script: tox -e static-analysis
  - stage: integration test
    python: 3.9
    script: tox -e py39-tests -- test/integrationtest
  - stage: deploy
    name: Deploy to PyPI
    deploy:
      provider: pypi
      username: "__token__"
      password:
        secure: "KpNR5XY2sC5TRmdqmV8qUWkG0VICpDN58j8JPe72IMrzRslgeuAFLUZh9otI9kNQsMUD3ri2fTdHJ9GCvdX+FjsXJoxefD2M/pOSIepZgH6wlY0IbJC7+44zICh2bwI85YjVdNmNOiuFfHi3wt9a8FAtrI8WejY38tSEHQq1IBTeud54MpivBu4lUqT9gzvzbDXSFr1zBDRu/0VJ3TejV8W3KLRlBA0ULW2f/OXRaKceLeUd0JTRxFD6u85eWAk9ypidJ8wdeQihjYYCjqZHi/3ZJ6YvQbk9qgpEbo7JTf/J9xWw1FGiGA7arGg4MmAiUunxR0LIi1b6Rnwx9SYAJpv1lchlaG5bkeDZh1Ef9SdUIBHRFWcWS9AXWx+XKBK5cD7XdyJB4QzVVUep1kGOV3FxE6HP3bmVzol+28FtkO3nF/+RxLpqR1I/oh0tqO+00Fy9gEU9Q/CYvgOb/LUxT9DykLD4TvfE+v3sePMuZYawRMQQq2T8vIROojudUOYhYuKRY/AGh0cFc/1ie/Con0NceUWzCdqUDA/q67AKcgluKfBQmkH3Fd8tSMhMhlnu7fFuee/umsY8cr7sZJl8JI3wLqqBF2P0l+P62NErJ70wVU8wyLSifeDXoK0S88sazhRueW4Gmiy5uHIu8hwxRNjDpy+x4M6AYl6xURnFS5Y="
      on:
        tags: true
      skip_existing: true
      distributions: sdist bdist_wheel
install:
- pip install tox-travis
- if [ "$TRAVIS_PYTHON_VERSION" = "3.9" ]; then pip install coveralls; fi
script: tox
after_success:
- if [ "$TRAVIS_PYTHON_VERSION" = "3.9" ]; then coveralls; fi
